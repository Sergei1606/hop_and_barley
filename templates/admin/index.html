<!-- templates/admin/index.html - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø -->
{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block extrahead %}
{{ block.super }}
<style>
    /* –°—Ç–∏–ª–∏ –¥–ª—è dashboard —Å !important */
    .dashboard {
        display: grid !important;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)) !important;
        gap: 20px !important;
        margin-bottom: 30px !important;
    }

    .card {
        background: white !important;
        border-radius: 8px !important;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1) !important;
        padding: 20px !important;
        transition: transform 0.2s !important;
        border: 1px solid #ddd !important;
        margin-bottom: 0 !important;
    }

    .card:hover {
        transform: translateY(-5px) !important;
        box-shadow: 0 5px 20px rgba(0,0,0,0.15) !important;
    }

    .card h3 {
        margin-top: 0 !important;
        color: #333 !important;
        border-bottom: 2px solid #4CAF50 !important;
        padding-bottom: 10px !important;
        margin-bottom: 15px !important;
        font-size: 1.2em !important;
    }

    .metric {
        font-size: 2.5em !important;
        font-weight: bold !important;
        color: #2c3e50 !important;
        margin: 10px 0 !important;
    }

    .metric-label {
        color: #7f8c8d !important;
        font-size: 0.9em !important;
        text-transform: uppercase !important;
    }

    .metric-green { color: #27ae60 !important; }
    .metric-blue { color: #2980b9 !important; }
    .metric-orange { color: #e67e22 !important; }
    .metric-red { color: #e74c3c !important; }

    .stats-grid {
        display: grid !important;
        grid-template-columns: repeat(2, 1fr) !important;
        gap: 10px !important;
        margin-top: 15px !important;
    }

    .stat-item {
        text-align: center !important;
        padding: 10px !important;
        background: #f8f9fa !important;
        border-radius: 5px !important;
    }

    .stat-value {
        font-size: 1.5em !important;
        font-weight: bold !important;
        display: block !important;
    }

    .stat-label {
        font-size: 0.8em !important;
        color: #6c757d !important;
        display: block !important;
    }

    .table-dashboard {
        width: 100% !important;
        border-collapse: collapse !important;
        margin-top: 15px !important;
    }

    .table-dashboard th {
        background: #f1f8ff !important;
        text-align: left !important;
        padding: 10px !important;
        font-weight: 600 !important;
        border-bottom: 2px solid #dee2e6 !important;
    }

    .table-dashboard td {
        padding: 10px !important;
        border-bottom: 1px solid #eee !important;
    }

    .badge {
        display: inline-block !important;
        padding: 3px 8px !important;
        border-radius: 12px !important;
        font-size: 0.8em !important;
        font-weight: bold !important;
    }

    .badge-pending { background: #fff3cd !important; color: #856404 !important; }
    .badge-paid { background: #d1ecf1 !important; color: #0c5460 !important; }
    .badge-shipped { background: #d4edda !important; color: #155724 !important; }
    .badge-delivered { background: #c3e6cb !important; color: #155724 !important; }
    .badge-red { background: #f8d7da !important; color: #721c24 !important; }

    .quick-links {
        display: flex !important;
        flex-wrap: wrap !important;
        gap: 10px !important;
        margin-top: 20px !important;
        padding-top: 20px !important;
        border-top: 1px solid #dee2e6 !important;
    }

    .quick-link {
        display: inline-block !important;
        padding: 8px 15px !important;
        background: #4CAF50 !important;
        color: white !important;
        text-decoration: none !important;
        border-radius: 5px !important;
        font-size: 0.9em !important;
    }

    .quick-link:hover {
        background: #45a049 !important;
        text-decoration: none !important;
        color: white !important;
    }

    .status-item {
        display: flex !important;
        justify-content: space-between !important;
        padding: 8px 0 !important;
        border-bottom: 1px solid #eee !important;
    }

    .status-color {
        width: 12px !important;
        height: 12px !important;
        border-radius: 50% !important;
        display: inline-block !important;
        margin-right: 8px !important;
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard">
    <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ 1: –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="card">
        <h3>üìä –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>

        <!-- –í–∞—Ä–∏–∞–Ω—Ç 1: –ï—Å–ª–∏ finance_stats —Å—É—â–µ—Å—Ç–≤—É–µ—Ç -->
        {% if finance_stats %}
        <div class="metric metric-green">{{ finance_stats.total_revenue|default:"0" }} ‚ÇΩ</div>
        {% else %}
        <!-- –í–∞—Ä–∏–∞–Ω—Ç 2: –ï—Å–ª–∏ total_revenue —Å—É—â–µ—Å—Ç–≤—É–µ—Ç -->
        <div class="metric metric-green">{{ total_revenue|default:"0" }} ‚ÇΩ</div>
        {% endif %}

        <div class="metric-label">–û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞</div>

        <div class="stats-grid">
            <div class="stat-item">
                {% if order_stats %}
                <div class="stat-value">{{ order_stats.total|default:"0" }}</div>
                {% else %}
                <div class="stat-value">{{ total_orders|default:"0" }}</div>
                {% endif %}
                <div class="stat-label">–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤</div>
            </div>

            <div class="stat-item">
                {% if product_stats %}
                <div class="stat-value">{{ product_stats.total|default:"0" }}</div>
                {% else %}
                <div class="stat-value">{{ total_products|default:"0" }}</div>
                {% endif %}
                <div class="stat-label">–¢–æ–≤–∞—Ä–æ–≤</div>
            </div>

            <div class="stat-item">
                {% if user_stats %}
                <div class="stat-value">{{ user_stats.total|default:"0" }}</div>
                {% else %}
                <div class="stat-value">{{ total_users|default:"0" }}</div>
                {% endif %}
                <div class="stat-label">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
            </div>

            <div class="stat-item">
                {% if finance_stats %}
                <div class="stat-value">{{ finance_stats.avg_order|default:"0"|floatformat:2 }} ‚ÇΩ</div>
                {% else %}
                <div class="stat-value">{{ avg_order_value|default:"0"|floatformat:2 }} ‚ÇΩ</div>
                {% endif %}
                <div class="stat-label">–°—Ä–µ–¥–Ω–∏–π —á–µ–∫</div>
            </div>
        </div>

        {% if finance_stats and finance_stats.today_orders > 0 %}
        <div style="margin-top: 15px; font-size: 0.9em; color: #666;">
            üìÖ –°–µ–≥–æ–¥–Ω—è: {{ finance_stats.today_orders }} –∑–∞–∫–∞–∑–æ–≤ –Ω–∞ {{ finance_stats.today_revenue }} ‚ÇΩ
        </div>
        {% endif %}
    </div>

    <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ 2: –°—Ç–∞—Ç—É—Å—ã –∑–∞–∫–∞–∑–æ–≤ -->
    <div class="card">
        <h3>üì¶ –°—Ç–∞—Ç—É—Å—ã –∑–∞–∫–∞–∑–æ–≤</h3>

        {% if order_stats and order_stats.by_status %}
            <!-- –í–∞—à —Ñ–æ—Ä–º–∞—Ç —Å—Ç–∞—Ç—É—Å–æ–≤ -->
            {% for status in order_stats.by_status %}
            <div class="status-item">
                <div>
                    <span class="status-color" style="background-color: {{ status.color }};"></span>
                    {{ status.status_display }}
                </div>
                <strong>{{ status.count }}</strong>
            </div>
            {% endfor %}
        {% else %}
            <!-- –ú–æ–π —Ñ–æ—Ä–º–∞—Ç —Å—Ç–∞—Ç—É—Å–æ–≤ -->
            <table class="table-dashboard">
                <tr>
                    <td>–û–∂–∏–¥–∞—é—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏</td>
                    <td><span class="badge badge-pending">{{ pending_orders|default:"0" }}</span></td>
                </tr>
                <tr>
                    <td>–û–ø–ª–∞—á–µ–Ω—ã</td>
                    <td><span class="badge badge-paid">{{ paid_orders|default:"0" }}</span></td>
                </tr>
                <tr>
                    <td>–û—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã</td>
                    <td><span class="badge badge-shipped">{{ shipped_orders|default:"0" }}</span></td>
                </tr>
                <tr>
                    <td>–î–æ—Å—Ç–∞–≤–ª–µ–Ω—ã</td>
                    <td><span class="badge badge-delivered">{{ delivered_orders|default:"0" }}</span></td>
                </tr>
                <tr>
                    <td>–û—Ç–º–µ–Ω–µ–Ω—ã</td>
                    <td><span class="badge badge-red">{{ cancelled_orders|default:"0" }}</span></td>
                </tr>
            </table>
        {% endif %}
    </div>

    <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ 3: –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–∫–∞–∑—ã -->
    <div class="card">
        <h3>üÜï –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–∫–∞–∑—ã</h3>
        {% if recent_orders %}
        <table class="table-dashboard">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                    <th>–°—É–º–º–∞</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                </tr>
            </thead>
            <tbody>
                {% for order in recent_orders %}
                <tr>
                    <td><a href="/admin/orders/order/{{ order.id }}/change/">#{{ order.id }}</a></td>
                    <td>{{ order.user.email|truncatechars:20 }}</td>
                    <td>{{ order.total_price }} ‚ÇΩ</td>
                    <td>
                        {% if order.status == 'pending' %}
                            <span class="badge badge-pending">–û–∂–∏–¥–∞–µ—Ç</span>
                        {% elif order.status == 'paid' %}
                            <span class="badge badge-paid">–û–ø–ª–∞—á–µ–Ω</span>
                        {% elif order.status == 'shipped' %}
                            <span class="badge badge-shipped">–û—Ç–ø—Ä–∞–≤–ª–µ–Ω</span>
                        {% elif order.status == 'delivered' %}
                            <span class="badge badge-delivered">–î–æ—Å—Ç–∞–≤–ª–µ–Ω</span>
                        {% else %}
                            <span class="badge badge-red">–û—Ç–º–µ–Ω–µ–Ω</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p>–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤</p>
        {% endif %}
    </div>

    <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ 4: –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã -->
    <div class="card">
        <h3>üî• –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã</h3>
        {% if popular_products %}
        <table class="table-dashboard">
            <thead>
                <tr>
                    <th>–¢–æ–≤–∞—Ä</th>
                    <th>–ü—Ä–æ–¥–∞–Ω–æ</th>
                    <th>–í—ã—Ä—É—á–∫–∞</th>
                </tr>
            </thead>
            <tbody>
                {% for product in popular_products %}
                <tr>
                    <td>{{ product.name|truncatechars:25 }}</td>
                    <td>{{ product.total_sold|default:"0" }} —à—Ç.</td>
                    <td>{{ product.total_revenue|default:"0" }} ‚ÇΩ</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ø—Ä–æ–¥–∞–∂–∞—Ö</p>
        {% endif %}
    </div>
</div>

<!-- –ë—ã—Å—Ç—Ä—ã–µ —Å—Å—ã–ª–∫–∏ -->
<div class="quick-links">
    <a href="/admin/products/product/" class="quick-link">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</a>
    <a href="/admin/orders/order/" class="quick-link">üì¶ –í—Å–µ –∑–∞–∫–∞–∑—ã</a>
    <a href="/admin/products/category/" class="quick-link">üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏</a>
    <a href="/admin/auth/user/" class="quick-link">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a>
    <a href="/admin/orders/order/add/" class="quick-link">üõí –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑</a>
</div>

<!-- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –º–æ–¥—É–ª–∏ Django -->
{{ block.super }}
{% endblock %}

{% block sidebar %}
{% endblock %}